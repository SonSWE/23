@{
    ViewBag.Title = "Table";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <div class="col">
        <div id="btn-add__table" class="content__food">
            <i class="fas fa-plus"></i>
            <span>Thêm mới</span>
        </div>
    </div>
</div>
<div class="row" id="rowTable">
    
</div>

<div class="box__layout">
    <div id="table-add" class="box__layout-add">
        <div class="layout-add__header">
            <h3 id="modelTitle" >Thêm bàn</h3>
        </div>
        <div class="layout-add__content">
            <input hidden id="id" value=""/>
            <div class="add__input-wrap">
                <input id="name" type="text" placeholder="Tên danh mục">
            </div>
            <div class="add__input-wrap">
                <input id="status" type="text" placeholder="Trang thái">
            </div>
        </div>
        <div class="layout-add__btn">
            <button id="save-btn__table" class="layout-add__save">Lưu</button>
            <button id="out-btn__table" class="layout-add__out ">Thoát</button>
        </div>
    </div>
    <div id="delete-table_layout" class="box__layout-delete">
        <div class="layout-delete__header">
            <h3>Bạn có chắc muốn xóa</h3>
        </div>
        <div class="layout-delete__btn">
            <button id="accept-btn__table" class="layout-delete__accept">Đồng ý</button>
            <button id="reject-btn__table" class="layout-delete__out ">Thoát</button>
        </div>
    </div>
</div>
@section scripts{
    <script>


        const add_TableLayout = document.querySelector('#table-add') // them san pham modal o bang dieu khien
        const del_TableLayout = document.querySelector('#delete-table_layout')

        const navBtn = document.querySelectorAll('.sidebar__menu-link')
        document.querySelector('.sidebar__menu-link.active').classList.remove('active')
        navBtn[1].classList.add('active')

        //Load
        $(document).ready(function () {
            LoadTableList();
        });

        //button add new
        $('#btn-add__table').click(function () {
            //set up to add new item
            $('#id').val('');
            //open modal add new
            $('#modelTitle').text('Thêm mới danh mục');
            add_TableLayout.style.display = "block";
            add_TableLayout.parentElement.style.display = "flex";
        });

        //buntton close
        $('#out-btn__table').click(function () {
            //set up modal to default
            $('#name').val('');
            $('#status').val('');
            $('#name').prop('readonly', false);
            $('#status').prop('readonly', false);
            $('#save-btn__table').show();

            //close modal
            add_TableLayout.style.display = "none";
            add_TableLayout.parentElement.style.display = "none"
        });


        //button show infor each row item
        $(document).on('click', "i[name='view']", function () {
            let id = $(this).closest('i').attr('Id');

            //show infor
            $.ajax({
                url: '/Home/GetInforTable',
                type: 'get',
                data: {
                    id: id
                },
                success: function (data) {
                    if (data.code == 200) {
                        const table = JSON.parse(data.table)
                        //show infor category
                        $('#name').val(table.Name);
                        $('#status').val(table.Note);

                        //set up modal to show infor
                        $('#name').prop('readonly', true);
                        $('#status').prop('readonly', true);
                        $('#save-btn__table').hide();

                        //open modal show item
                        $('#modelTitle').text('Thông tin chi tiết');
                        add_TableLayout.style.display = "block";
                        add_TableLayout.parentElement.style.display = "flex";
                    } else {
                        alert(data.msg);
                    }
                }

            });
        })

        //button edit at each row item
        $(document).on('click', "i[name='edit']", function () {
            let id = $(this).closest('i').attr('Id');

            $.ajax({
                url: '/Home/GetInforTable',
                type: 'get',
                data: {
                    id: id
                },
                success: function (data) {
                    if (data.code == 200) {
                        const table = JSON.parse(data.table)
                        //show infor item
                        $('#id').val(id);
                        $('#name').val(table.Name);
                        $('#status').val(table.Note);

                        //set up to edit item
                        $('#name').prop('readonly', false);
                        $('#status').prop('readonly', false);
                        $('#save-btn__table').show();

                        //open modal edit item
                        $('#modelTitle').text('Chỉnh sửa thông tin bàn');
                        add_TableLayout.style.display = "block";
                        add_TableLayout.parentElement.style.display = "flex";
                    } else {
                        alert(data.msg);
                    }
                }

            });
        })

        //button save
        $('#save-btn__table').click(function () {
            //get value input
            let name = $('#name').val().trim();
            let status = $('#status').val().trim();
            //get id
            let id = $('#id').val().trim();

            //check data is valid or invalid
            if (name.length == 0) {
                alert('Vui lòng nhập đủ dữ liệu để tiếp tục');
                return;
            }

            //check event is add new or edit
            if (id.length == 0) {
                //add new table
                $.ajax({
                    url: '/Home/AddTable',
                    type: 'post',
                    data: {
                        name: name,
                        status: status
                    },
                    success: function (data) {
                        if (data.code == 200) {
                            $('#name').val('');
                            $('#status').val('');
                            LoadTableList();
                            alert(data.msg);
                        } else {
                            alert(data.msg);
                        }
                    }
                });
            } else {
                //save change table
                $.ajax({
                    url: '/Home/EditTable',
                    type: 'post',
                    data: {
                        id: id,
                        name: name,
                        status: status
                    },
                    success: function (data) {
                        if (data.code == 200) {
                            $('#name').val('');
                            $('#status').val('');
                            LoadTableList();
                            alert(data.msg);
                        } else {
                            alert(data.msg);
                        }
                    }
                });
            }

        });

        $(document).on('click', "i[name='order']", function () {
            let id = $(this).closest('i').attr('Id');
            $.ajax({
                url: 'Home/SaveIdTableToSession',
                type: 'post',
                data: {
                    id: id
                },
                success: function (data) {
                    if (data.code == 500) {
                        alert(data.msg);
                    }
                }
            })
        });

        //button delete each row item
        $(document).on('click', "i[name='delete']", function () {
            let id = $(this).closest('i').attr('Id');
            $('#id').val(id);
            del_TableLayout.style.display = "block";
            del_TableLayout.parentElement.style.display = "flex";
        });

        //accept delete table
        $('#accept-btn__table').click(function () {
            //get id
            let id = $('#id').val().trim();

            $.ajax({
                url: '/Home/DeleteTable',
                type: 'post',
                data: {
                    id: id
                },
                success: function (data) {
                    if (data.code == 200) {
                        //close modal
                        del_TableLayout.style.display = "none";
                        del_TableLayout.parentElement.style.display = "none";

                        $('#name').val('');
                        $('#status').val('');
                        LoadTableList();
                    } else {
                        alert(data.msg);
                    }
                }
            });
        });

        //buntton close del modal
        $('#reject-btn__table').click(function () {
            //close modal
            del_TableLayout.style.display = "none";
            del_TableLayout.parentElement.style.display = "none";
        });


        //method
        function LoadTableList() {
            $.ajax({
                url: "/Home/GetTableList",
                type: "get",
                success: function (data) {
                    if (data.code == 200) {
                        const tables = JSON.parse(data.tableList);
                        MakeTableList(tables);
                    }
                }
            });
        }

        function MakeTableList(tables) {
            $('#rowTable').empty();

            $.each(tables, function (k, v) {

                let tb = "<div style='display: block;' class='col l-3'>";
                tb += "<div class='table__menu-wrap'>";
                tb += "<h3>" + v.Name + "</h3>";
                tb += "<div class='table__menu - btn'>";
                tb += "<i id='" + v.Id + "' name='view' class='fas fa-ellipsis-h'></i>"
                tb += "<i id='" + v.Id + "' name='edit' class='fas fa-pencil-alt'></i>"
                tb += "<a href='/Order/Cart' ><i id='" + v.Id + "' name='order' class='fas fa-cash-register'></i></a>"
                tb += "<i id='" + v.Id + "' name='delete' class='fas fa-trash'></i>"
                tb += "</div>";
                tb += "</div>";
                tb += "</div >";
             
                $('#rowTable').append(tb);
            });
        }
    </script>
}
